---
title: 有趣的终端颜色
date: 2020-11-19 14:18:03
tags:
  - 终端
  - 转义
  - 终端颜色
category:
  - 终端
---

## 终端颜色历史

话说多年以前,人们还是用终端窗口进行和电脑交互.

随着科技的发展电脑开始支持颜色显示,最初只支持 3/4bit 的颜色显示.

后来大家都开始支持 8bit 的颜色显示也就是 0-255 之间的颜色,r 占 3 位 g 占 3 位 b 占两位,大大丰富了终端界面的对于颜色显示的要求.

再后来大家支持 rgb `255*255*255` 的颜色显示,但是目前兼容性上面存在问题,比如苹果自带的终端就不支持这种显示.

### 终端转义字符

了解了终端颜色支持程度之后,当然好奇怎么让终端显示颜色啊,对于前端人员来说 console.log 通过%c 就可以输出各种格式字符串

详见
[console.log 打印带样式的字体](https://developer.mozilla.org/en-US/docs/Web/API/console#Styling_console_output)

那么终端应该如何展示呢?

这时候终端转义字符闪亮登场

我们常见的转义字符大概就是`\n`了

然而终端转义字符功能可支持光标操作,输出文字样式控制等.

对于这些特殊的终端转义字符我们需要通过用
`ESC[参数字节;中间字节;最终字节`

举个例子

```bash
echo "f\033[2;K"
```

尝试一下看看会输出什么,你会惊奇的发现输出的东西被吃掉了,这是因为 \033 ascii 表达就是 ESC 的意思

上面我们说过由于历史原因终端支持多种颜色

- 3/4bit
- 8bit
- 24bit(支持不是特别好)

那么如何在终端显示这些颜色呢

### 3/4bit 的颜色

`\033[参数m`

快速使用

**ps: `ESC 0 m` 可以重置当前样式 **

```bash
echo "\033[参数;m文字\033[0;m"
```

| 颜色   | 前景色 | 后景色 |
| ------ | ------ | ------ |
| 黑     | 30     | 40     |
| 红     | 31     | 41     |
| 绿     | 32     | 42     |
| 黄     | 33     | 43     |
| 蓝     | 34     | 44     |
| 品红   | 35     | 45     |
| 青     | 36     | 46     |
| 白     | 37     | 47     |
| 灰     | 90     | 100    |
| 亮红   | 91     | 101    |
| 亮绿   | 92     | 102    |
| 亮黄   | 93     | 103    |
| 亮蓝   | 94     | 104    |
| 亮品红 | 95     | 105    |
| 亮青   | 96     | 106    |
| 亮白   | 97     | 107    |

### 8bit(255)颜色范围

255 颜色分为 3 段

0-15 同上面显示一样

- 0-7：标准颜色（同 ESC [ 30–37 m）
- 8-15：高强度颜色（同 ESC [ 90–97 m）

16-231 的颜色计算方式为

- 16 + 36 × r + 6 × g + b (0 ≤ r, g, b ≤ 5)

232-255 从黑到白的 24 阶段灰度色

#快速使用

```bash
# 文字颜色
echo "\033[38;5;颜色m文字\033[0m"
# 文字背景颜色
echo "\033[48;5;颜色m文字\033[0m"
```

### 24bit 颜色

这个就是当下比较流行的 rgb 显示了

```bash
# 文字颜色
echo "\033[38;5;r;g;bm文字\033[0m"
# 文字背景颜色
echo "\033[48;5;r;g;bm文字\033[0m"
```

## 终端中 24bit 转换到 8bit 颜色

```js
var color = 36 * (r / 51) + 6 * (g / 51) + b / 51 + 16;
```

# hsl 和 rgb 关系

RGB 使用三原色叠加的方式生成大量不同的颜色,但是这三种方式与所撑撑的颜色之间的联系并不直观.

而 hsl 相比于 rgb 更加直观.

由于终端不支持 hsl 显示我们需要写一个 hsl 转换 rgb 的方法

```go
func (hsl *HSL) HSL2RGB() (*RGB, error) {
	h := hsl.h
	s := hsl.s
	l := hsl.l
	C := (1 - math.Abs(2*l-1)) * s
	hPrime := h / 60
	X := C * (1 - math.Abs(math.Mod(hPrime, 2)-1))
	m := l - C/2
	withLight := func(r, g, b, m float64) *RGB {
		return &RGB{(r + m) * 255, (g + m) * 255, (b + m) * 255}
	}
	if hPrime <= 1 {
		return withLight(C, X, 0, m), nil
	} else if hPrime <= 2 {
		return withLight(X, C, 0, m), nil
	} else if hPrime <= 3 {
		return withLight(0, C, X, m), nil
	} else if hPrime <= 4 {
		return withLight(0, X, C, m), nil
	} else if hPrime <= 5 {
		return withLight(X, 0, C, m), nil
	} else if hPrime <= 6 {
		return withLight(C, 0, X, m), nil
	} else {
		return &RGB{0, 0, 0}, errors.New("hsl 解析出错")
	}

}
```

## color 演示

一些颜色的案例已经收录到我写的 go 模块中大家可以看源码参考

[github go color](https://github.com/suxin2017/color)

进入目录即可看到下面效果

```
cd test && go run test
```

![image](http://note.youdao.com/yws/public/resource/5d5aea4808cdf33a1b5cdbefb5aa5dcc/WEBRESOURCE94fed21ffab580271db6b978b3137861?ynotemdtimestamp=1605766931907)

## 参考文章

- [HSL 和 HSV 色彩空间](https://zh.wikipedia.org/wiki/HSL%E5%92%8CHSV%E8%89%B2%E5%BD%A9%E7%A9%BA%E9%97%B4)
- [ANSI 转义序列](https://zh.wikipedia.org/wiki/ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97)
- [CSS Colors: Color Conversion](https://codepen.io/AdamGiese/pen/YBaOYX?editors=0010)
- [How to manipulate CSS colors with JavaScript](https://blog.logrocket.com/how-to-manipulate-css-colors-with-javascript-fb547113a1b8/)
